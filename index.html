<!DOCTYPE html>
<html>
    <head>
        <style>
            /* Custom Styles here */

            /* Sets Sanserif font for whole page. Serifs are Yuk */
            body {
            font-family: "Roboto", sans-serif;
            font-size: 17px; 
            }

            /* https://stackoverflow.com/questions/52472667/how-to-display-image-in-css-grid/52473643 */
            /* CSS grid */
            #item {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                grid-column-gap: 25px;
                grid-row-gap: 25px;
            }

            #item > div img {
                max-width: 100%;
                max-height: 100%;
            }
            

        .eachItem {
            background-color: lightgrey;
        }

        </style>
    </head>
    <body>
        <!-- Finds CDN Scripts such as Jquery -->
        <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
        </script>

        <!-- My Main Script -->

    <script>
    $( document ).ready(function() {

        // -----------------------
        // ALA WEB API
        // https://api.ala.org.au/#
        // -----------------------
        // EXAMPLES
        // https://biocache-ws.ala.org.au/ws/occurrences/search?fq=occurrence_decade_i:%222020%22&q=genus:%22Macropus%22
        // https://bie.ala.org.au/ws/search.json?q=frog
        // https://collections.ala.org.au/ws/dataResource

            // Api Key and Api URL set as constants
            // const apiKey = "&apikey=e1l09TYfUkdo9BMpfiUn5oV74IHmBcRe";
            // const query = ;

            const apiUrl = "https://bie.ala.org.au/ws/search.json?q=frog&pageSize=40"; // Should equal the search item object

            // Read out the url to see where its getting the data from
            console.log(apiUrl);


        // Fetch the api Url then respond with the json information 
        $.getJSON(apiUrl, function(searchResults) {

            // Console the url
            console.log(searchResults);

                // Create variables to use in the project 
                let searchObject = searchResults.searchResults;
                let queryItem = searchObject.queryTitle;
                // const firstResult = searchResults.results[0].name;
                let allResults = searchObject.results;


                // Add the collection title to the page and  add the number of results found
                // https://stackoverflow.com/questions/5122402/uppercase-first-letter-of-variable 

                $('#heading')
                .append('<h1>' + queryItem + '</h1>')
                .css('textTransform', 'capitalize')
                .append('<h2> Number of Results: ' + searchObject.totalRecords + '</h2>');

            
                // create a variable that holds all the searched results 
                let frogData = allResults;
                    console.log(allResults);


                // For each item that is searched  
                for(let i = 0; i <allResults.length; i++) {

                    // Adds an image if there is one in the object. This also prints the name out. 
                    $('#item').append('<div class="eachItem"'+ allResults[i].id +
                    '><h3>' + allResults[i].name + '</h3>' + '<img src=' + 
                    allResults[i].smallImageUrl + ' style="width: 100%; height: 300px;"><div class="noImage"></div> <p class="hiddenText" style="display: none"> Author name: <br>' + 
                    allResults[i].author +'</p></div>');
                
                    // What happens when there is no image found. AKa the broken image url
                    // https://stackoverflow.com/questions/56166094/update-img-src-if-image-does-not-exist

                    $('.eachItem img').on('error', function() {
                        this.src = 'https://piotrkowalski.pw/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png';
                            // https://piotrkowalski.pw/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png
                        });

                    // If no 
    
                }

   


                // https://api.jquery.com/toggle/
                // https://api.jquery.com/find/

                // When the user clicks on the little tile  
                $(".eachItem").click(function() {

                    // For the item that has been clicked find the item with class hiddentext and show/hide it
                    $(this).find(".hiddenText").toggle();

                });                

                // $('img').on("error", function() {
                //         // $(this).append('src', '/assets/images/image.jpg');
                //         console.log("no image found");
                //         $('.noImage').append("<p> No image found</p>");
                //     });

            


        });

    });
    </script>

        <div id="heading"></div>
        <div id="item"></div>
        

    </body>
</html>
